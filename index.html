<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Prescription Advisor</title>
	<link rel="stylesheet" href="./css/style.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">	<script src="./js/script.js"></script>
  <script src="js/script.js"></script>
</head>
<body>

	<nav class="navbar navbar-inverse bg-inverse navbar-fixed-top">
  	<a class="navbar-brand" href="login.html" style="color:white">Prescription Advisor</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">Admins</a>
        </li>
      </ul>
    </div>
	</nav>

	<div class="row">
	<div class="main col-md-9">
		<div class="header">
			<h1><script>
					var data = localStorage.getItem('_name');
			    if (!data){
						document.location.href = 'error/404.html';
					};
			    localStorage.removeItem('_name');
			    data = atob(data);
			    let name = JSON.parse(data);
					document.write("Patient: " + name.First + " " + name.Last)
			</script></h1>
		</div>
		<div class="search">
				<input id="search" type="text" class="form-control" name="search" placeholder="Medication...">
				<button id="submit" type="button" class="btn" name="button" onclick="checkMedication()">Submit</button>
		</div>

		<div id="alerts">

		</div>
	</div>

	<div class="medication col-md-3">
		<h3>Current Medication</h3>
		<div id="drugs">
		</div>
	</div>
	</div>

	<!-- Users medication -->
	<script type="text/javascript">
	var drugs = localStorage.getItem('_drugs');
	localStorage.removeItem('_drugs');
	if(!drugs){
	}
	drugs = atob(drugs);
	var medication = JSON.parse(drugs);
	medication = medication.drug
	for (var i = 0; i < medication.length; i++) {
		generateCard(medication[i]);
	}

	// Send New Medication
	function checkMedication() {
		document.getElementById("alerts").innerHTML = ""

		var newMedication = document.getElementById("search").value;
		var drug = medication[0].substring(medication[0].indexOf("(") + 1, medication[0].indexOf(")"));

		var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "http://127.0.0.1:5000/combine/drug=" + drug + "&check_drug=" + newMedication, false);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send();
		var response = JSON.parse(xhttp.responseText);
		generateAlert(response.description);

	}

	</script>

</body>
</html>
